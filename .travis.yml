services:
- docker
env:
  global:
  - GCP_PROJECT_ID=devops-eksamen-295808
  - tf_version=0.13.2
  - CLOUDSDK_CORE_DISABLE_PROMPTS=1
  - secure: xB3B0w9tV+0RVWh0jBoH3eTnCzO2eu+rzbgWafrGLIt7LyXhZx7BcZK/VdcxLci13sn63E4KecKHocG5WOwZJEfZAfPCrUPYZTTz3juG8JD65q+1sClz3QGIvZ/Jh4/ISWzKo7gSoBjEIyV1Mnk9jx7fA1BJMCxmQLxbVweBhn3hpy0WI3/VLZAtpBcSBIYcwTJ5/Rhe31p4CkaECne9vjqu4CngY9d2O/es2nC2lYH8gTqLXDxAI3eXIws4WGXJu6dqFXgFOALO5hwE3LzDY393YywXoRjCbYrU+JNk3/9maodSDm3fnZGAcdzg9Ars9Q89604de8ztR+Z84hLZDw2GkFT9+UCkjwaVf2BsP7DLj17F45n7WfVvIwI5BVEOolesym6YXN3hPnbFivlmkYCbsklaNNUxF66KeC3jdK5cVepQoZPXIcploHiNbLmLGnTm5Kj10LCMEwpnvvVolmqvlYsjg0oOYb+azkFaaTatJciKxVzS653pbLB2qFd9XB5tvTGmEju47gXVFer9oXNKd4VqmXVSvn/Yh0KFol/T8KkEQyZrpdPqzEzyTnQlYnImhpu0rp+TP8dtGHoADMCzb2ZYoZPgh7fLz2qitCUCVE013l4aCen6w8PmqiYUhzLYjzF7vrsOw3nZNO5dvKH/h85jvjnh8ZCkWMVzhNQ=
  - secure: 1uOX6e5cgeCcRZ5BDnHOVeFbJY2Pkpdu4g2+eFEIXjSh5rG8SjLOVz8fztJaCt/ULGA8+r8armot9+RY3TLWKcAruMGQ32mNdPgB32U72B8GjeEaHSr9PlZtW89duPFLkCyPmyJg2BVx3vxi3/9SGGsdpcf4HMLdFFgBRh78R1B4mOSgDw87sx9UKKwvHP8gyaFVufdc8FhXLagB5wE0PYE48D5iyE7DaCU+3kPQwCSrMzlu9B03xCIdlOk34cugo54dRDuI7Y+we8ttJqHomNKDmy/X8W4uo9K4QTSkJUpafQKR6d6x+iEwA7zitzD5muUQadBxLxtREBU/NKoPZNvMQkMM3IAZeP/y52fcdZUZPQ1q3Q7byLlIGiar0m2Ux4a0P/xwz2HJz/K6exFiBRyjLbRoFHuXEubtuoLoGqZY7wlDaenvf5I+qg3Ia3HSvvDOxy3UtmSDnAoLTVRaWbyqaQS8uxZu0CoPwfFbLP702eVKpBgj3NgpqbH4FgYSnQVgEXlaRXKq6hNQbo0NYql4qcXLyWoZOId5S4unuu7wdfVd35NymlAlJq1QQ6wB3KTk/B2cDvmGzTAGLTaIoHq0gzGAvkzkGyKxkZKWhoahzA+d6uD0BvfkkKz1IMGHbveSoWdCWZtuzuiKzlSzbQMxby8Qyis+ZDea4iTzIOI=
branches:
  only:
  - master
before_install:
- openssl aes-256-cbc -K $encrypted_08046dc9db46_key -iv $encrypted_08046dc9db46_iv
  -in GCP-key.json.enc -out GCP-key.json -d
- curl https://sdk.cloud.google.com | bash > /dev/null
- source "$HOME/google-cloud-sdk/path.bash.inc"
- gcloud auth activate-service-account --key-file=GCP-key.json
- gcloud config set project "${GCP_PROJECT_ID}"
- export GOOGLE_APPLICATION_CREDENTIALS=./GCP-key.json
- wget https://releases.hashicorp.com/terraform/"$tf_version"/terraform_"$tf_version"_linux_amd64.zip
- unzip terraform_"$tf_version"_linux_amd64.zip
- sudo mv terraform /usr/local/bin/
- rm terraform_"$tf_version"_linux_amd64.zip
install: true
script:
- |-
  set -ex;
  export tf_var_LOGZ_TOKEN=$LOGZ_TOKEN
  export tf_var_LOGZ_URL=$LOGZ_URL
  terraform init
  terraform plan
  terraform apply --auto-approve
  terraform output
